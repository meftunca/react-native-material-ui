import React, {useEffect, useState} from 'react';
import {
  Modal,
  StyleSheet,
  View,
  TouchableWithoutFeedback,
  KeyboardAvoidingView,
} from 'react-native';
import SafeAreaView from 'react-native-safe-area-view';
interface BackDropModalProps {
  visible?: boolean;
  fullScreen?: boolean;
  backdropColor?: string;
  animationType?: 'fade' | 'slide' | 'none';
  onClose?: () => void | undefined;
  children?: React.ReactNode;
}

const BackDropModal: React.FC<BackDropModalProps> = ({
  onClose,
  children,
  animationType,
  visible = false,
  fullScreen = false,
  backdropColor = 'transparent',
}) => {
  const [modalVisible, setModalVisible] = useState<boolean>(visible);
  useEffect(() => {
    return () => onClose && onClose();
  }, []);

  useEffect(() => {
    if (visible === true) setModalVisible(true);
    else if (backdropColor === 'transparent') setModalVisible(visible);
    else
      setTimeout(() => {
        setModalVisible(visible);
      }, 200);
  }, [visible]);
  return (
    <Modal
      transparent
      supportedOrientations={[
        'landscape',
        'landscape-left',
        'landscape-right',
        'portrait',
        'portrait-upside-down',
      ]}
      animated={true}
      hardwareAccelerated={true}
      animationType={animationType}
      visible={modalVisible}
      onDismiss={onClose}
      onRequestClose={onClose}>
      <View
        pointerEvents={visible ? 'auto' : 'none'}
        accessibilityViewIsModal
        accessibilityLiveRegion="polite"
        style={[StyleSheet.absoluteFill]}>
        <TouchableWithoutFeedback style={{zIndex: 0}} onPress={onClose}>
          <View
            style={{
              flex: 1,
              backgroundColor: backdropColor,
            }}
          />
        </TouchableWithoutFeedback>
        <SafeAreaView
          style={[
            fullScreen === true && {
              backgroundColor: 'white',
            },
            {
              ...StyleSheet.absoluteFillObject,
              justifyContent: 'center',
              alignContent: 'center',
              alignItems: 'center',
              alignSelf: 'center',
              flexGrow: 1,
              flexShrink: 1,
              // backgroundColor: 'red',
              zIndex: 999,
            },
            fullScreen && {flex: 1, height: '100%'},
          ]}
          pointerEvents="box-none">
          <KeyboardAvoidingView
            behavior="height"
            style={[
              {
                width: fullScreen ? '100%' : '80%',
                backgroundColor: 'transparent',
                justifyContent: 'center',
                alignSelf: 'center',
              },
            ]}>
            {children}
          </KeyboardAvoidingView>
        </SafeAreaView>
      </View>
    </Modal>
  );
};

export default BackDropModal;
