{"version":3,"sources":["usePortal.web.tsx"],"names":["useState","useRef","useEffect","useCallback","createPortal","findDOMNode","count","usePortal","closeOnOutsideClick","closeOnEsc","renderOnClickedElement","renderBelowClickedElement","bindTo","document","body","isOpen","defaultIsOpen","stateful","makeOpen","open","setOpen","v","current","renderByRef","portal","createElement","elToMountTo","window","handleKeydown","e","ESC","keyCode","openPortal","nativeEvent","stopImmediatePropagation","style","closePortal","handleOutsideMouseClick","target","button","contains","appendChild","addEventListener","removeEventListener","removeChild","onMouseDown","ref","togglePortal","Portal","children","bind"],"mappings":"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","sourcesContent":["import {useState, useRef, useEffect, useCallback} from 'react';\nimport {createPortal, findDOMNode} from 'react-dom';\nlet count = 0;\ndeclare global {\n  interface Window {\n    // add you custom properties and methods\n    portal: any;\n  }\n}\ninterface portalFace {\n  closeOnOutsideClick?: boolean;\n  closeOnEsc?: boolean;\n  renderOnClickedElement?: any;\n  renderBelowClickedElement?: any; // appear directly under the clicked element/node in the DOM\n  bindTo?: any; // attach the portal to this node in the DOM\n  isOpen?: boolean;\n  stateful?: boolean;\n}\nexport const usePortal = ({\n  closeOnOutsideClick = true,\n  closeOnEsc = true,\n  renderOnClickedElement,\n  renderBelowClickedElement, // appear directly under the clicked element/node in the DOM\n  bindTo = document.body, // attach the portal to this node in the DOM\n  isOpen: defaultIsOpen = false,\n  stateful = true,\n}: portalFace) => {\n  const [isOpen, makeOpen] = useState(defaultIsOpen);\n  const open = useRef(isOpen);\n  const setOpen = v => {\n    open.current = v;\n    makeOpen(v);\n  };\n\n  // useEffect(() => {\n  //   // runs whenever we call setState on `isOpen`\n  //   console.log('IS OPEN? ', isOpen);\n  //   makeOpen(!isOpen);\n  // }, [isOpen]);\n\n  const renderByRef = useRef();\n  const portal = useRef<any>(document.createElement('div'));\n  const elToMountTo =\n    (bindTo && findDOMNode(bindTo)) || (document && document.body);\n  window.portal = portal;\n\n  const handleKeydown = useCallback(\n    e => {\n      var ESC = 27;\n      if (!closeOnEsc) return;\n      e.keyCode === ESC && stateful && setOpen(false);\n    },\n    [stateful],\n  );\n\n  const openPortal = e => {\n    if (e == null) {\n      setOpen(true);\n      return;\n    }\n    if (e && e.nativeEvent) e.nativeEvent.stopImmediatePropagation();\n    if (renderOnClickedElement) {\n      portal.current.style = `\n        height: 100%;\n        position: fixed;\n        left: 0;\n        right:0;\n        bottom:0;\n        top: 0;\n      `;\n    } else if (renderBelowClickedElement) {\n      portal.current.style = `\n      height: 100%;\n      position: fixed;\n      left: 0;\n      right:0;\n      bottom:0;\n      top: 0;\n      `;\n    }\n    stateful && setOpen(true);\n  };\n\n  const closePortal = useCallback(() => {\n    open.current && setOpen(false);\n  }, [isOpen, setOpen]);\n\n  const handleOutsideMouseClick = ({target, button}) => {\n    window[`target${count++}`] = target;\n    if (\n      portal.current.contains(target) ||\n      !open.current ||\n      button !== 0 ||\n      !portal.current\n    )\n      return;\n    stateful && closeOnOutsideClick && closePortal();\n  };\n\n  useEffect(() => {\n    elToMountTo.appendChild(portal.current);\n    document.addEventListener('keydown', handleKeydown);\n    document.addEventListener('click', handleOutsideMouseClick);\n    return () => {\n      document.removeEventListener('keydown', handleKeydown);\n      document.removeEventListener('click', handleOutsideMouseClick);\n      elToMountTo.removeChild(portal.current);\n    };\n  }, []);\n\n  return {\n    isOpen: open.current,\n    openPortal,\n    onMouseDown: handleKeydown,\n    ref: renderByRef,\n    closePortal,\n    togglePortal: e => (isOpen ? setOpen(false) : openPortal(e)),\n    Portal: ({children}) => createPortal(children, portal.current),\n    bind: {\n      onMouseDown: handleKeydown,\n      ref: renderByRef,\n    },\n  };\n};\n\nexport default usePortal;\n\n/**\n * @example\n * import React from \"react\";\n *   import { render } from \"react-dom\";\n *   import usePortal from \"./usePortal\";\n *\n *   const App = () => {\n *   const {\n *       openPortal: openFirstPortal,\n *       closePortal: closeFirstPortal,\n *       isOpen: isFirstOpen,\n *       Portal: FirstPortal\n *   } = usePortal();\n *   const {\n *       openPortal: openSecondPortal,\n *       closePortal: closeSecondPortal,\n *       isOpen: isSecondOpen,\n *       Portal: SecondPortal\n *   } = usePortal();\n *   // isSecondOpen is always false!\n *   console.log({ isFirstOpen, isSecondOpen });\n *\n *   return (\n *       <>\n *       <button onClick={openFirstPortal}>Open First</button>\n *       {isFirstOpen && (\n *           <FirstPortal>\n *           I'm First.\n *           <button\n *               onClick={() => {\n *               closeFirstPortal();\n *               openSecondPortal();\n *               }}\n *           >\n *               Close Me and Open Second\n *           </button>\n *           </FirstPortal>\n *       )}\n *       {isSecondOpen && (\n *           <SecondPortal>\n *           I'm Second<button onClick={closeSecondPortal}>Close Me</button>\n *           </SecondPortal>\n *       )}\n *       </>\n *   );\n *   };\n */\n"]}